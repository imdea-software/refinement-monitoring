%!TEX root = head.tex

\section{Concurrent collections ??}

We define the class of concurrent libraries considered in this paper. 

\subsection{Matching Relations}

We distinguish two sets of operation labels $\<PosLab> \subseteq \<Labels>$ and $\<NegLab> \subseteq \<Labels>$, called \emph{positive}, resp., \emph{negative}, operations labels.

\begin{example}

Positive and negative labels for different objects.

\end{example}

We assume that each concurrent library comes with a matching relation $\<Matching>$ between negative and positive labels such that for every history $h$ of that library, each negative operation label in $h$ is matched to a unique positive label in $h$. Sometimes it is also required that every two different negative operation labels are matched to different positive labels.

\begin{definition}

A relation $\<Matching>\subseteq \<NegLab>\times \<PosLab>$ is a \emph{matching relation} for a library $L$ iff for every history $h=\tup{O,<,f}$ in $H(L)$, the following holds:
\begin{itemize}
	\item for every $o\in O$ such that $f(o)\in \<NegLab>$, there exists an unique $o'\in O$ such that $\<Matching>(f(o),f(o'))$.
\end{itemize}

A matching relation $\<Matching>$ is called \emph{injective} iff for every history $h=\tup{O,<,f}$ in $H(L)$ and $o_1\neq o_2\in O$ with $\{f(o_1),f(o_2)\}\in \<NegLab>$, there exist two different operations $o_1'\neq o_2'\in O$ such that $\<Matching>(f(o_1),f(o_1'))$ and $\<Matching>(f(o_2),f(o_2'))$.

\end{definition}

An operation $o$ is called \emph{negative}, resp., \emph{positive}, in a history $h=\tup{O,<,f}$ iff $f(o)\in \<NegLab>$, resp., $f(o)\in \<PosLab>$.

\begin{example}

Examples of relations $\<Matching>$ and how they can be implemented.

\end{example}

\subsection{Kernel Closure Properties}

In this work, we consider the problem of checking refinement with respect to libraries $L$ for which $\ker L$ is defined.
The histories of executions in $\ker L$ are $H(\ker L)=\set{H(e) : e\in \ker L}$.

A \emph{prefix} of a history $h=\tup{O,<,f}$ is a history $h'=\tup{O',<',f'}$, that contains a subset of the operations in $h$,
i.e., $O'\subseteq O$, $<'=<|_{O'}$, and $f'=f|_{O'}$, and that is downward closed w.r.t. $<$, i.e., $o\in O'$ and $o'<o$ implies $o'\in O'$.

\begin{example}

Prefix of a history.

\end{example}

\begin{lemma}\label{lemma:kernel_histories_prefix}

Let $L$ be a library for which $\ker L$ is defined. The set of histories $H(\ker L)$ is prefix-closed.

\end{lemma}

Given a history $h=\tup{O,<,f}$, a set of operations $O'\subseteq O$ is called a \emph{matching cluster}
iff $O'$ consists of a single negative operation $o$ and all positive operations $o'$ with $\<Matching>(o,o')$.
A set of histories $H$ is closed under matching cluster removal iff $H$ contains all the histories
obtained by removing a matching cluster from another history in $H$. 
%We say that 
%a library $L$ is \emph{$\<Matching>$-closed} iff the set of kernel histories is closed under 
%matching cluster removal. 
Formally, given a history $h=\tup{O,<,f}$ and $O'\subseteq O$, 
\[
h\setminus O'=\tup{O\setminus O',<',f'},
\] 
where $<'=<|_{O\setminus O'}$, and $f'=f|_{O\setminus O'}$.

\begin{definition}

A set of histories $H$ is \emph{closed under matching cluster removal} 
(for short, $\<Matching>$-closed)
iff for every matching cluster $O'$ of a history $h\in H$,
the history $h\setminus O'$ also belongs to $H$.

\end{definition}

\begin{example}

Show that all objects we know satisfy this property.

\end{example}
